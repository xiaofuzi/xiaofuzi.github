<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>笨方法学习C语言（中文版）</title>
   <meta name="author" content="小福的博客" />
 
   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />

   <script type="text/javascript" src="/js/name.js"></script>

</head>
<body>



<div class="site">
  <div class="title">
    <a href="/">小福</a>
    <a class="extra" href="/">首页</a>
    
    <a class="extra" href="/others/mywebsites.html">Love websites</a>
     <a class="extra" href="http://www.douban.com/doulist/37760519/?sort=time">我的豆列</a>
  </div>
 
  <div id="post">
<h1 id="pythonmake">类似Python的Make脚本</h1>
<p>在<a href="http://learnpythonthehardway.org/">Python</a>编程中，你只需要编写你想要运行的代码就可以运行程序了。Python解释器会自己帮你导入你需要的库文件到解释器中然后运行你的程序。而C程序与Python是有很大的差别的，你需要编译你的源文件然后将它们链接得到一个二进制文件才能够运行。手工来做这些是很痛苦的，接下来的练习将教你如何使用make来做这些工作。</p>

<p>在这个练习中，你将会在学习C的同时学习一个GNU make的快速教程。在本书的余下部分都会用到make，你会像使用Python一样使用它，make会帮你构建你的代码，运行测试程序以及对程序进行设置等。</p>

<p>与Python不同的是我会像你展示一些Makefile的魔法，可以让你不用关心C程序的所有的细节就可编译运行它，在这个练习中并没有这些说明，但是我会在你使用简单的make一段时间后向你展示更加高级的用法。</p>

<h1 id="make">make的使用</h1>
<p>首先你会使用make构建一个它已经知道如何构建的程序，make已经足够的聪明来构建许多类型的文件。在前一个练习中你已经使用了如下的命令：</p>

<pre><code>$ make ex1
# or this one too
$ CFLAGS="-Wall" make ex1
</code></pre>

<p>第一个命令告诉make创建一个名为ex1的文件，然后make会做如下的一些工作：
 * 检查ex1文件是否存在？
 * 如果不存在，那么就检查是否有其它的文件以ex1开头？
 * 如果有一个叫做 ex1.c的文件？make 会确认自己是否可以构建 .c 类型的文件？ 
 * 如果会，那么就运行 cc ex1.c -0 ex1来构建。
 *make将会创建一个名为ex1的文件</p>

<p>第二条命令与第一条相比，多传送了一些标识信息给make命令。如果你对于Unix Shell是如何工作的不是很熟悉的话，你要知道你创建的这些环境变量是可以被你的程序所使用的。根据你使用的Shell的不同，你可能会使用这样的命令 CFLAGS=”-wall”。你只要在你运行的命令的前面放上这些信息，那么这些环境变量就会在命令运行的时候被设置好。</p>

<p>在这个例子中，我在命令行之前添加 CFLAGS=”-wall” 来构建 ex1文件，它将会给命令添加  -wall的标识来让make运行。该标识会让编译器报告所有的警告信息（事实上是尽可能的所有）。</p>

<p>事实上你可以使用make来做更多的事情，让我们来编写一个Makefile文件来帮助你更好的理解make。首先创建一个文件然后添加如下的信息：</p>

<pre><code>CFLAGS = -wall -g
clean
  rm -f ex1
</code></pre>

<p>在保存上述文件到你的当前目录中，取名为Makefile。Make会自动的找到该文件然后运行它。注意：在编写makefile文件时使用tab来缩进而没有使用空格键。</p>

<p>在这个文件中，我们看到了一些新的东西，首先我们在文件中设置了 CFLAGS，所以我们在使用make命令时不在需要设置，-g 表示对程序进行调试。在最后我们用clean来清除我们对项目所做的处理。</p>

<p>请确保上述文件和你的ex1.c文件在同一个目录中，然后在终端中运行如下命令：</p>

<pre><code> $ make clean
 $ make ex1
</code></pre>

<h1 id="section">你将会得到怎样的结果？</h1>
<p>如果命令正常运行的话，你将会看到如下的结果</p>

<pre><code>$ make clean
rm -f ex1
$ make ex1
cc -Wall -g  ex1.c -o ex1
ex1.c:In function 'main':
ex1.c:3:waring:implicit declaration of function 'puts'
$
</code></pre>

<p>首先我会运行make clean 来清除目标文件，重新阅读Makefile文件，看我让make做了什么？你也可以添加更多你想要的命令俩运行它。它就是如此智能的一个工具。</p>

<pre><code>提示：
如果你已经在ex1.c中添加了 #include&lt;stdio.h&gt;,那么你的输出中将没有puts的警告信息，这里出现是因为我并没有修正这个错误。

可以看到，即使我们并没有在makefile文件中提到 ex1 文件，但是make 同样知道如何来构建它。
</code></pre>

<h1 id="section-1">如何打破它？</h1>
<p>这对你来说，作为开始已经足够了，在这里我将让你观察对makefile做一些错误的处理会得到什么样的结果。将 rm -f ex1 移除然后将项目清除并运行，你会得到如下的结果：</p>

<pre><code>$ make clean
Makefile:4*** missing separator. Stop.
</code></pre>

<p>当你出现奇怪的错误的时候，你需要更加注意你在缩进时是否使用的是tab键还是空格键，make对这个是十分敏感的。</p>

<h1 id="section-2">课外练习</h1>

<ul>
  <li>创建一个只有 all:ex1的makefile文件，然后调用make命令。</li>
  <li>阅读make手册来了解更多关于make的信息</li>
  <li>阅读 cc 编译器手册来了解更多关于 -Wall 和 -g 做了什么。</li>
  <li>在网上查找关于makefile的资料学习。</li>
  <li>在另外一个C程序中找到它的makefile文件并试着去了解它做了什么。</li>
</ul>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
  </ul>
</div>
  
  <div class="footer">
    <div class="contact">
      <p>
        xiaofuzi
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="http://github.com/xiaofuzi/">github.com/xiaofuzi</a><br />
      </p>
    </div>
  </div>
</div>

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253593759'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1253593759' type='text/javascript'%3E%3C/script%3E"));</script>
</body>
</html>
